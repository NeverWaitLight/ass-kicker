## ADDED Requirements

### Requirement: 用户认证与令牌管理

系统提供基于 JWT 的认证机制，包含以下需求：

- 用户可通过用户名和密码登录获取 JWT 令牌
- 签发 access token（有效期 1 天）和 refresh token（有效期 30 天）
- 状态为 DISABLED 的用户不得登录
- 用户名匹配区分大小写
- 登录成功后更新用户的 last_login_at 字段
- 受保护的 API 端点必须校验 JWT 签名和过期时间
- 提供刷新 access token 的接口
- 支持 ADMIN 和 USER 两种角色访问业务接口

#### Scenario: 用户成功登录
- **WHEN** 用户提供正确的用户名和密码
- **THEN** 系统返回 access token 和 refresh token

#### Scenario: 禁用用户登录失败
- **WHEN** 状态为 DISABLED 的用户尝试登录
- **THEN** 系统拒绝登录请求

#### Scenario: 令牌刷新
- **WHEN** 用户提供有效的 refresh token
- **THEN** 系统返回新的 access token

---

### Requirement: 用户 CRUD 管理

管理员可对用户进行创建、读取、更新和删除操作：

- 管理员可创建新用户（用户名必须唯一，保存密码哈希和角色）
- 管理员可删除任意用户
- 管理员可重置任意用户的密码
- 管理员可获取用户列表（支持分页和搜索，默认每页 10 条）
- 用户可修改自己的用户名（新用户名必须唯一）
- 用户可修改自己的密码（需验证旧密码）
- 非管理员访问用户管理接口返回 403

#### Scenario: 管理员创建用户
- **WHEN** 管理员提交包含用户名、密码和角色的表单
- **THEN** 系统创建用户并返回成功响应

#### Scenario: 用户名冲突
- **WHEN** 创建用户时使用的用户名已存在
- **THEN** 系统返回错误提示

#### Scenario: 用户修改自己的密码
- **WHEN** 用户提供正确的旧密码和新密码
- **THEN** 系统更新密码并返回成功响应

---

### Requirement: 动态角色分配

系统根据注册条件动态分配用户角色：

- 第一个注册的用户自动获得 ADMIN 角色
- 后续注册的用户获得默认 USER 角色
- 角色信息持久化到用户数据模型
- 访问管理功能前验证用户角色
- 支持基于条件的扩展角色分配策略

#### Scenario: 首个用户自动晋升管理员
- **WHEN** 系统中没有任何用户，新用户注册
- **THEN** 该用户自动获得 ADMIN 角色

#### Scenario: 后续用户获得普通角色
- **WHEN** 系统中已有用户，新用户注册
- **THEN** 该用户获得默认的 USER 角色
