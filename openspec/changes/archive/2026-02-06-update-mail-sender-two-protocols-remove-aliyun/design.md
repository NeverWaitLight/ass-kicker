## Context

当前系统的邮件发送能力由阿里云邮件 sender 实现该实现同时承担了协议细节厂商 sdk 集成以及配置解析等多种职责导致业务层与阿里云渠道强绑定在配置层面也使用阿里云特有字段例如 region accessKey 等缺乏对其他协议的抽象支持
本次变更需要通过统一的邮件发送抽象支持至少两种不同的邮件协议例如通用 smtp 协议以及基于 http api 的协议同时移除现有阿里云邮件 sender 相关的实现与配置字段在保证业务对外行为不变的前提下完成底层实现重构

## Goals / Non-Goals

**Goals**

引入协议无关的邮件发送接口定义并基于配置选择具体协议实现
实现 smtp 协议 sender 和 http api 协议 sender 两种实现并可通过配置自由切换
为两种协议设计清晰的配置模型包含连接认证安全与重试等维度并接入现有配置中心
将现有依赖阿里云邮件 sender 的调用迁移到新的抽象上同时完全移除阿里云专用 sender 及其配置
确保在不同协议下的错误处理日志与可观测性满足排障需求

**Non Goals**

不在本次中引入第三种及以上协议实现仅为后续扩展预留接口与配置结构
不改变上游业务触发邮件发送的业务流程与对外接口行为
不在本次中处理历史邮件数据归档或查询相关能力

## Decisions

在领域或应用层定义协议无关的邮件发送接口例如 MailSender 抽象提供发送单封邮件和批量邮件等基础操作接口参数使用与协议无关的通用邮件模型包含收件人主题正文附件等
在基础设施层实现两种具体 sender 实现 SmtpMailSender 和 HttpApiMailSender 分别封装底层协议细节连接池管理重试策略以及异常转换并暴露统一的错误语义给上层
新增 MailSenderFactory 或基于依赖注入容器的配置驱动工厂根据配置中的协议类型字段如 smtp 或 httpApi 构造具体实现支持在运行时根据环境选择不同协议实现
在配置模型上拆分出多协议配置结构顶层包含当前启用协议类型字段以及针对各协议的子配置块例如 smtpConfig 和 httpApiConfig 并通过类型安全的方式在加载阶段完成校验
对现有直接使用阿里云 sender 的代码进行适配迁移通过引入适配层将阿里云 sender 调用点替换为对 MailSender 抽象的调用避免业务直接感知具体协议实现细节
在依赖管理中移除阿里云邮件 sdk 依赖如果仍需短期保留作为备份则通过特性开关或独立模块隔离但默认实现仅基于 smtp 或 http api

## Risks  Trade offs

多协议抽象可能引入额外的复杂度如果协议语义差异较大需要在抽象层处理边界情况可能带来实现难度为降低风险需要在抽象接口层保持最小通用子集并通过扩展点支持协议特有能力
现有阿里云 sender 移除过程中如果遗漏调用点或配置字段可能导致某些环境下邮件发送失败需要通过静态代码搜索和配置巡检工具确保迁移完整性并在灰度阶段启用详细日志
不同协议在性能和稳定性上可能存在差异例如 smtp 连接建立成本较高而 http api 依赖外部网关限流需要在设计中支持超时重试与熔断策略并通过压测和预发环境验证
配置结构调整会影响现有部署脚本和配置管理流程如果迁移不当可能导致线上环境启动失败需要提供清晰的配置迁移文档并在应用启动时增加配置校验与友好错误提示

