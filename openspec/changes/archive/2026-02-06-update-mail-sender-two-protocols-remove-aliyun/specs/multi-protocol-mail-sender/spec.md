## ADDED Requirements

### Requirement: 支持多协议邮件发送抽象
系统必须提供协议无关的邮件发送抽象接口该接口以通用邮件模型为输入并在运行时基于配置选择具体协议实现如 smtp 协议或 http api 协议

#### Scenario: 使用 smtp 协议发送邮件
- **WHEN** 系统配置中启用 smtp 协议并提供合法的 smtp 连接配置且业务通过抽象接口请求发送一封合法邮件
- **THEN** 系统必须使用 smtp 协议建立连接完成认证并成功将邮件投递到目标收件人或上游网关并在成功时返回成功结果

#### Scenario: 使用 http api 协议发送邮件
- **WHEN** 系统配置中启用 http api 协议并提供合法的 api 端点和认证配置且业务通过抽象接口请求发送一封合法邮件
- **THEN** 系统必须调用配置的 http api 端点完成认证并将邮件内容提交给上游服务在对方返回成功时将成功结果返回给调用方

### Requirement: 协议选择与切换
系统必须允许通过配置选择当前启用的邮件协议并支持在不同环境中使用不同协议无需修改业务代码

#### Scenario: 按环境切换协议实现
- **WHEN** 生产环境配置启用 http api 协议预发环境配置启用 smtp 协议且两套环境都提供完整有效的协议配置
- **THEN** 在生产环境邮件发送必须实际通过 http api 实现在预发环境邮件发送必须实际通过 smtp 实现且两种环境下业务调用接口保持一致

### Requirement: 协议级错误统一抽象
系统必须将底层协议特有错误统一抽象为有限集合的错误类型例如配置错误连接错误认证错误发送失败等以便上层可以进行稳定的错误处理

#### Scenario: 认证失败错误抽象
- **WHEN** 底层 smtp 协议因用户名密码错误导致认证失败或者 http api 因无效 token 被拒绝
- **THEN** 抽象接口返回的错误类型必须统一标记为认证错误并包含可用于排查的上下文信息但不得泄露敏感凭证内容
